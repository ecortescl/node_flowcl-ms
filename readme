Flow Payment Microservice API
=============================

üöÄ Overview
-----------
Este microservicio en Node.js integra la API de Flow para la creaci√≥n y gesti√≥n de √≥rdenes de pago.
Con √©l puedes:
  ‚Ä¢ Crear una orden de pago y obtener la URL final para redirigir al usuario.
  ‚Ä¢ Procesar callbacks as√≠ncronos (confirmaci√≥n de pago).
  ‚Ä¢ Redirigir al usuario a p√°ginas de "pago exitoso" o "pago cancelado".
  ‚Ä¢ Regenerar una orden de pago en caso de necesitar reintento.
  ‚Ä¢ Realizar testing de forma segura, enviando las credenciales (apiKey y secretKey) v√≠a headers.

üîí Security
------------
Las credenciales se manejan de forma segura a trav√©s de los headers:
  ‚Ä¢ x-api-key: Clave p√∫blica (API Key)
  ‚Ä¢ x-secret-key: Clave secreta (Secret Key)
  
La API utiliza estas claves para generar una firma HMAC-SHA256 que garantiza la integridad y seguridad en la comunicaci√≥n con Flow.

üìö Features
-----------
‚Ä¢ **Create Payment Order:** Genera una orden en Flow y retorna una URL final (combinando el token y la URL base) para redirigir al usuario.
‚Ä¢ **Payment Confirmation:** Endpoint que recibe callbacks (urlConfirmation) de Flow para confirmar el estado del pago.
‚Ä¢ **Success & Cancel Endpoints:** P√°ginas de redirecci√≥n para indicar el resultado del pago.
‚Ä¢ **Regenerate Payment Order:** Permite reintentar la creaci√≥n de una orden de pago.
‚Ä¢ **Swagger UI Integration:** Documentaci√≥n interactiva y testing de la API en [http://localhost:3000/api-docs](http://localhost:3000/api-docs)

üíª Installation
---------------
1. Clona el repositorio:
   git clone https://github.com/tuusuario/flow-payment-microservice.git
   cd flow-payment-microservice

2. Instala las dependencias:
   npm install

3. Configura las variables de entorno (opcional):
   Puedes crear un archivo .env con:
     FLOW_API_URL=https://www.flow.cl/api
     API_KEY=tu_api_key
     SECRET_KEY=tu_secret_key
     PORT=3000

4. Inicia el servidor:
   node index.js

El servidor se ejecutar√° en el puerto 3000 (o el especificado en la variable de entorno).

üõ†Ô∏è Usage
---------
- **Swagger UI:**
  Abre tu navegador en http://localhost:3000/api-docs y usa la documentaci√≥n interactiva.
  Haz clic en "Authorize" para ingresar las credenciales de forma segura (x-api-key y x-secret-key).

- **Endpoints Principales:**
  ‚Ä¢ POST /create-payment
      - Crea una orden de pago.
      - Request Body (JSON): commerceOrder, subject, currency, amount, email, urlConfirmation, urlReturn, etc.
      - Response: { paymentLink, flowOrder }

  ‚Ä¢ POST /payment/confirmation
      - Callback as√≠ncrono de Flow. Recibe el token del pago (en formato x-www-form-urlencoded).
      - Response: "OK" (texto plano).

  ‚Ä¢ GET /payment/success
      - Redirecci√≥n para pago exitoso.
      - Query Param: token
      - Response: P√°gina HTML con detalles del pago.

  ‚Ä¢ GET /payment/cancel
      - Redirecci√≥n para pago cancelado.
      - Response: P√°gina HTML indicando la cancelaci√≥n.

  ‚Ä¢ POST /payment/regenerate
      - Regenera la orden de pago (usa la misma l√≥gica que create-payment).
      - Request Body (JSON): Los mismos par√°metros que create-payment.
      - Response: { paymentLink, flowOrder }

‚ú® Contributing
---------------
¬°Las contribuciones son bienvenidas! Si deseas aportar mejoras o corregir errores, abre issues o env√≠a pull requests.
Por favor, sigue las gu√≠as de estilo y documenta tus cambios.

üìú License
-----------
Este proyecto est√° licenciado bajo la licencia MIT.

üôå Support
-----------
Si tienes preguntas o necesitas asistencia, por favor abre un issue en GitHub o contacta al mantenedor.

¬°Disfruta usando la Flow Payment Microservice API! üòÑ
